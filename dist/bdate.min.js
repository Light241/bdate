angular.module("bdate.datepicker",["bdate.popup","bdate.data","bdate.templates"]).directive("bdatepicker",["$filter","bDataFactory",function(t,e){return{restrict:"E",replace:!0,templateUrl:"default.html",scope:{source:"=",bRootId:"@?",bInputId:"@?",bPopupId:"@?"},controller:function(){return e.makeDataQuery()},link:function(a){return a.date={viewed:"",model:{}},a.$watch("date.model",function(){var r,n;if(!angular.equals({},a.date.model))return r=new Date(a.date.model.year,a.date.model.month-1,a.date.model.day).getTime(),n=t("date")(r,e.data.format),a.date.viewed=n}),a.popup={state:{isOpen:!1}},a.togglePopup=function(){return a.popup.state.isOpen=!a.popup.state.isOpen}}}}]),angular.module("bdate.data",[]).factory("bDataFactory",function(){var t,e;return e={format:"dd-MM-yyyy",today:{date:1432537266825,year:2015,month:5,day:25,day_of_week:1},years:{2013:{1:{days_total:31,start_day:2}},2014:{5:{days_total:31,start_day:4},6:{days_total:30,start_day:7},7:{days_total:31,start_day:2},8:{days_total:31,start_day:5},9:{days_total:30,start_day:1},10:{days_total:31,start_day:3}},2015:{2:{days_total:28,start_day:7},3:{days_total:31,start_day:7},4:{days_total:30,start_day:3},5:{days_total:31,start_day:5}},2016:{1:{days_total:31,start_day:5}},2017:{1:{days_total:31,start_day:7},2:{days_total:28,start_day:3}}}},t={data:null,setData:function(e){return t.data=e},makeDataQuery:function(){return t.setData(e)}}}),angular.module("bdate",["bdate.datepicker"]).constant("MESSAGES",{invalidParams:"Invalid params",errorOnChangeMonthOrYear:"cannot change month or year"}),angular.module("bdate.popup",["bdate.utils","bdate.data","bdate.templates"]).directive("bdatePopup",["bDateUtils","bDataFactory","MESSAGES",function(t,e,a){return{restrict:"E",replace:!0,templateUrl:"popup.html",scope:{popupState:"=",dateModel:"="},link:function(r){return r.popup={hidePopup:function(){return r.popupState.isOpen=!1},selectDate:function(t){return r.data.setDateModel(t),r.popup.hidePopup()}},r.data={setDateModel:function(t){return t?r.dateModel=t:console.error(a.invalidParams)},format:null,setFormat:function(t){return t?r.data.format=t:console.error(a.invalidParams)},viewedDate:null,setViewedDate:function(n,s){return n&&s?(n=+n,s=+s,r.data.viewedDate={year:{first:Object.keys(e.data.years)[0],last:Object.keys(e.data.years)[Object.keys(e.data.years).length-1],number:n,count:Object.keys(e.data.years).length},month:{first:Object.keys(e.data.years[n])[0],last:Object.keys(e.data.years[n])[Object.keys(e.data.years[n]).length-1],daysTotal:e.data.years[n][s].days_total,startDay:e.data.years[n][s].start_day,number:s,name:t.getMonthName(s),count:Object.keys(e.data.years[n]).length}},r.data.viewedDate.days=r.data.getDaysArr(r.data.viewedDate.year,r.data.viewedDate.month)):console.error(a.invalidParams)},daysOfWeek:{get:function(){return t.daysOfWeek},getShorts:function(){return t.getDaysOfWeekShorts()}},today:null,setToday:function(t){return t?r.data.today=t:console.error(a.invalidParams)},_getPrevMonthTailDaysArr:function(e,a,r){var n,s,o,d;for(d=[],n=1,s=t.sourceCheckers.month.isPrevMonthExist(e,a),o={day:null,month:null,year:null},s&&(o=t.sourceCheckers.month.getPrevMonthObj(e,a));r-1>=n;)d.push({day:n,month:o.month,year:o.year,isOtherMonth:!0}),n++;return d},_getNextMonthTailDaysArr:function(e,a,r,n,s){var o,d,i,u,c,h;if(h=[],o=7,d=Math.ceil(s.length/o),s.length/o===Math.floor(s.length/o))return h;for(u=t.sourceCheckers.month.isLastMonth(e,a),c=t.sourceCheckers.year.isLastYear(e,a),i=s.length;d*o>i;)s.push({day:i-(n+r-2),month:a+1,year:e}),i++;return h},_getMonthDaysArr:function(t,e,a){var r,n;for(n=[],r=1;a>=r;)n.push({day:r,month:e,year:t}),r++;return n},getDaysArr:function(t,e){var a,n,s,o,d,i;return n=+e.daysTotal,i=+e.startDay,o=r.data._getPrevMonthTailDaysArr(t.number,e.number,i),a=r.data._getMonthDaysArr(t.number,e.number,n),d=o.concat(a),s=r.data._getNextMonthTailDaysArr(t.number,e.number,i,n,d),d=d.concat(s)},goNextMonth:function(e){var a;return a=t.sourceCheckers.month.getNextAvailableMonth(e,r.data.viewedDate.year.number,r.data.viewedDate.month.number),a?r.data.setViewedDate(a.year,a.month):void 0},goNextYear:function(e){var a;return a=t.sourceCheckers.year.getNextAvailableYear(e,r.data.viewedDate.year.number,r.data.viewedDate.month.number),a?r.data.setViewedDate(a.year,a.month):void 0},init:function(e){var a;return r.data.setFormat(e.format),r.data.setToday(e.today),t.sourceCheckers.month.isMonthExist(e.today.year,e.today.month)?r.data.setViewedDate(e.today.year,e.today.month):(a=t.sourceCheckers.year.getFirstYear(),r.data.setViewedDate(a,t.sourceCheckers.month.getFirstMonth(a)))}},function(){return r.data.init(e.data),r.bDateUtils=t}()}}}]),angular.module("bdate.utils",["bdate.data"]).factory("bDateUtils",["MESSAGES","bDataFactory",function(t,e){var a,r,n;return a=[{name:"Понедельник","short":"Пн"},{name:"Вторник","short":"Вт"},{name:"Среда","short":"Ср"},{name:"Четверг","short":"Чт"},{name:"Пятница","short":"Пт"},{name:"Суббота","short":"Сб"},{name:"Воскресенье","short":"Вс"}],n={1:{name:"Январь","short":"Янв"},2:{name:"Февраль","short":"Фев"},3:{name:"Март","short":"Март"},4:{name:"Апрель","short":"Май"},5:{name:"Май","short":"Май"},6:{name:"Июнь","short":"Июнь"},7:{name:"Июль","short":"Июль"},8:{name:"Август","short":"Авг"},9:{name:"Сентябрь","short":"Сент"},10:{name:"Октябрь","short":"Окт"},11:{name:"Ноябрь","short":"Ноя"},12:{name:"Декабрь","short":"Дек"}},r={daysOfWeek:a,month:n,getDaysOfWeekShorts:function(){var t,e;for(t=0,e=[];t<a.length;)e.push(a[t]["short"]),t++;return e},getMonthName:function(t){return n[t].name},sourceCheckers:{month:{isMonthExist:function(a,r){return a&&r?(a=+a,r=+r,e.data.years[a]?!!e.data.years[a][r]:!1):console.error(t.invalidParams)},isPrevMonthExist:function(e,a){var n,s,o,d,i;return e&&a?(e=+e,a=+a,r.sourceCheckers.month.isMonthExist(e,a)?(n=r.sourceCheckers.month.isFirstMonth(e,a),n?(s=r.sourceCheckers.year.isFirstYear(e),s?!1:(i=e-1,o=r.sourceCheckers.month.getLastMonth(i),r.sourceCheckers.month.isMonthExist(i,o))):(d=a-1,r.sourceCheckers.month.isMonthExist(e,d))):!1):console.error(t.invalidParams)},getPrevMonthObj:function(e,a){var n,s,o,d,i;return e&&a?(e=+e,a=+a,n=r.sourceCheckers.month.isFirstMonth(e,a),n?(s=r.sourceCheckers.year.isFirstYear(e),s?null:(i=e-1,o=r.sourceCheckers.month.getLastMonth(i),r.sourceCheckers.month.isMonthExist(i,o)?{year:i,month:o}:null)):(d=a-1,r.sourceCheckers.month.isMonthExist(e,d)?{year:e,month:d}:null)):console.error(t.invalidParams)},isNextMonthExist:function(e,a){var n,s,o,d,i;return e&&a?(e=+e,a=+a,r.sourceCheckers.month.isMonthExist(e,a)?(s=r.sourceCheckers.month.isLastMonth(e,a),s?(o=r.sourceCheckers.year.isLastYear(e),o?!1:(i=e+1,n=r.sourceCheckers.month.getFirstMonth(i),r.sourceCheckers.month.isMonthExist(i,n))):(d=a+1,r.sourceCheckers.month.isMonthExist(e,d))):!1):console.error(t.invalidParams)},getNextMonthObj:function(e,a){var n,s,o,d,i;return e&&a?(e=+e,a=+a,s=r.sourceCheckers.month.isLastMonth(e,a),s?(o=r.sourceCheckers.year.isLastYear(e),o?null:(i=e+1,n=r.sourceCheckers.month.getFirstMonth(i),r.sourceCheckers.month.isMonthExist(i,n)?{year:i,month:n}:null)):(d=a+1,r.sourceCheckers.month.isMonthExist(e,d)?{year:e,month:d}:null)):console.error(t.invalidParams)},getMonth:function(a,r){return a&&r?e.data.years[a][r]:console.error(t.invalidParams)},isFirstMonth:function(t,a){return t=+t,a=+a,a===+Object.keys(e.data.years[t])[0]},getFirstMonth:function(t){return t=+t,+Object.keys(e.data.years[t])[0]},isLastMonth:function(t,a){return t=+t,a=+a,a===+Object.keys(e.data.years[t])[Object.keys(e.data.years[t]).length-1]},getLastMonth:function(t){return t=+t,+Object.keys(e.data.years[t])[Object.keys(e.data.years[t]).length-1]},getNextAvailableMonth:function(e,a,n){var s,o,d,i,u,c;if(a=+a,n=+n,o=r.sourceCheckers.month.isFirstMonth(a,n),d=r.sourceCheckers.month.isLastMonth(a,n),s=!1,u=a,i=n,e)if(d){if(s=!0,u=a+1,!r.sourceCheckers.year.isYearExist(u))return console.error(t.errorOnChangeMonthOrYear),!1;i=r.sourceCheckers.month.getFirstMonth(u)}else i=n+1;else if(!e)if(o){if(s=!0,u=a-1,!r.sourceCheckers.year.isYearExist(u))return console.error(t.errorOnChangeMonthOrYear),!1;i=r.sourceCheckers.month.getLastMonth(u)}else i=n-1;return c={year:u,month:i}}},year:{isYearExist:function(a){return a?(a=+a,!!e.data.years[a]):console.error(t.invalidParams)},getYear:function(a){return a?e.data.years[a]:console.error(t.invalidParams)},isFirstYear:function(t){return t=+t,t===+Object.keys(e.data.years)[0]},getFirstYear:function(){return+Object.keys(e.data.years)[0]},isLastYear:function(t){return t=+t,t===+Object.keys(e.data.years)[Object.keys(e.data.years).length-1]},getLastYear:function(){return+Object.keys(e.data.years)[Object.keys(e.data.years).length-1]},getNextAvailableYear:function(t,e,a){var n,s,o,d,i;if(e=+e,a=+a,n=r.sourceCheckers.year.isFirstYear(e),s=r.sourceCheckers.year.isLastYear(e),d=e,o=a,t){if(s)return!1;d=e+1,o=r.sourceCheckers.month.isMonthExist(d,a)?a:r.sourceCheckers.month.getFirstMonth(d)}else if(!t){if(n)return!1;d=e-1,o=r.sourceCheckers.month.isMonthExist(d,a)?a:r.sourceCheckers.month.getFirstMonth(d)}return i={year:d,month:o}}}}}}]),angular.module("bdate.templates",[]).run(["$templateCache",function(t){t.put("default.html","<div id={{bRootId}} class=b_datepicker_root><input type=text id={{bInputId}} ng-model=date.viewed readonly=readonly class=b_input><button type=button ng-click=togglePopup() class=b_datepicker_button>H</button><bdate-popup id={{bPopupId}} popup-state=popup.state date-model=date.model></bdate-popup></div>"),t.put("popup.html",'<div ng-show=popupState.isOpen class=b_popup><div class=b_popup_controls><div class=b_btn_prev_container><button type=button ng-click=data.goNextYear(false) ng-disabled="!bDateUtils.sourceCheckers.year.isYearExist(data.viewedDate.year.number - 1)" class="b_popup_btn b_btn_prev"><<</button><button type=button ng-click=data.goNextMonth(false) ng-disabled="!bDateUtils.sourceCheckers.month.isPrevMonthExist(data.viewedDate.year.number, data.viewedDate.month.number)" class="b_popup_btn b_btn_prev"><</button></div><div ng-bind=data.viewedDate.month.name class=b_popup_month></div>&nbsp;<div ng-bind=data.viewedDate.year.number class=b_popup_year></div><div class=b_btn_next_container><button type=button ng-click=data.goNextMonth(true) ng-disabled="!bDateUtils.sourceCheckers.month.isNextMonthExist(data.viewedDate.year.number, data.viewedDate.month.number)" class="b_popup_btn b_btn_next">></button><button type=button ng-click=data.goNextYear(true) ng-disabled="!bDateUtils.sourceCheckers.year.isYearExist(data.viewedDate.year.number + 1)" class="b_popup_btn b_btn_next">>></button></div></div><table class=b_popup_days><tr><td ng-repeat="dayOfWeek in ::data.daysOfWeek.getShorts()" class=b_popup_day_of_week><span ng-bind=::dayOfWeek></span></td></tr></table><table class=b_popup_weeks><tr class=b_popup_week><td ng-repeat="date in data.viewedDate.days track by $index" class=b_popup_day><button type=button ng-bind=date.day ng-click=popup.selectDate(date) ng-class="{b_popup_cur_month_day: !date.isOtherMonth}" class=b_popup_day_btn></button></td></tr></table><div class=b_popup_today>Сегодня &nbsp;<span ng-bind="data.today.date | date:data.format"></span></div></div>')}]);
//# sourceMappingURL=bdate.min.js.map