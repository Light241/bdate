angular.module("bdate.templates",[]).run(["$templateCache",function(e){e.put("bdate.html",'<div id={{::bRootId}} ng-class="{b_datepicker_in_progress: !isDataReady}" class="b_datepicker_root {{::bRootClasses}}"><input type=text id={{::bInputId}} ng-model=date.viewed ng-click=popup.togglePopup() ng-disabled=!isDataReady readonly=readonly class="b_datepicker_input {{::bInputClasses}}"><button type=button ng-click=popup.togglePopup() ng-disabled=!isDataReady class="b_datepicker_button {{::bButtonClasses}}">&nbsp;</button><bdate-popup id={{::bPopupId}} popup-state=popup.state date-model=date.model date-store-id={{::dateStoreId}} class={{::bPopupClasses}}></bdate-popup></div>'),e.put("popup.html",'<div ng-show=popupState.isOpen class=b_popup><div class=b_popup_controls><div class=b_btn_prev_container><button type=button ng-click=data.goNextYear(false) ng-disabled="!bDateUtils.sourceCheckers.year.isYearExist(data.viewedDate.year.number - 1, dateStoreId)" class="b_popup_btn b_btn_prev">&#9664;&#9664;</button><button type=button ng-click=data.goNextMonth(false) ng-disabled="!bDateUtils.sourceCheckers.month.isPrevMonthExist(data.viewedDate.year.number, data.viewedDate.month.number, dateStoreId)" class="b_popup_btn b_btn_prev">&#9664;</button></div><div ng-bind=data.viewedDate.month.name class=b_popup_month></div>&nbsp;<div ng-bind=data.viewedDate.year.number class=b_popup_year></div><div class=b_btn_next_container><button type=button ng-click=data.goNextMonth(true) ng-disabled="!bDateUtils.sourceCheckers.month.isNextMonthExist(data.viewedDate.year.number, data.viewedDate.month.number, dateStoreId)" class="b_popup_btn b_btn_next">&#9654;</button><button type=button ng-click=data.goNextYear(true) ng-disabled="!bDateUtils.sourceCheckers.year.isYearExist(data.viewedDate.year.number + 1, dateStoreId)" class="b_popup_btn b_btn_next">&#9654;&#9654;</button></div></div><table class=b_popup_days><tr><td ng-repeat="dayOfWeek in ::data.daysOfWeek.getShorts()" class=b_popup_day_of_week><span ng-bind=::dayOfWeek></span></td></tr></table><table class=b_popup_weeks><tr class=b_popup_week><td ng-repeat="date in data.viewedDate.days track by $index" ng-class="{b_popup_today_day_container: date.isToday}" class=b_popup_day><button type=button ng-bind=date.day ng-click=popup.selectDate(date) ng-disabled=date.isLocked ng-class="{b_popup_cur_month_day: !date.isOtherMonth, b_popup_today_day: date.isToday, b_popup_selected_day: date.day == dateModel.day &amp;&amp; date.month == dateModel.month &amp;&amp; date.year == dateModel.year, b_popup_locked_day: date.isLocked}" class=b_popup_day_btn></button></td></tr></table><div ng-show="bDateUtils.isMonthExist(data.today.year, data.today.month, dateStoreId)" class=b_popup_today>Сегодня<button type=button ng-bind="data.today.date | date:data.format" ng-click=popup.selectDate(bDateUtils.makeDateModel(data.today.date)) class=b_popup_today_btn></button></div></div>')}]),angular.module("bdate.datepicker",["bdate.popup","bdate.data","bdate.templates"]).directive("bdatepicker",["$filter","bDataFactory","bDateUtils","$document","$interval",function(e,t,a,r,o){return{restrict:"E",replace:!0,templateUrl:"bdate.html",scope:{bModel:"=",bSource:"=",bRootId:"@?",bInputId:"@?",bPopupId:"@?",bRootClasses:"@?",bInputClasses:"@?",bButtonClasses:"@?",bPopupClasses:"@?"},controller:["$scope",function(e){var a;return a=function(){return Math.random().toString(36).substring(12)},e.dateStoreId=a(),e.isDataReady=!1,e.$watch("bSource",function(){return t.isDataValid(e.bSource)?(t.setData(e.bSource,e.dateStoreId),e.isDataReady=!0):void 0},!0)}],link:function(n,s){var d,i,u,c;return n.date={viewed:"",model:{}},d=!1,c=function(){var e,r,o;return o=n.bModel===n.date.viewed,r=""===n.bModel||" "===n.bModel||!n.bModel,o||r?!1:(e=a.stringToDate(n.bModel,t.data[n.dateStoreId].format,t.data[n.dateStoreId].delimiter),angular.isDate(e)?(n.date.viewed=n.bModel,d=!0,n.date.model={day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()}):!1)},i=o(function(){return n.isDataReady?(c(),o.cancel(i),i=void 0):void 0},60),n.$watch("bModel",function(e,t){return e!==t?c():void 0}),n.$watch("date.model",function(){var a,r;if(!angular.equals({},n.date.model))return d?d=!1:(a=new Date(n.date.model.year,n.date.model.month-1,n.date.model.day).getTime(),r=e("date")(a,t.data[n.dateStoreId].format),n.date.viewed=r,n.bModel=n.date.viewed)}),u=function(e){var t,a,r,o;return a=n.popup.state.isOpen,t=e.target,o=s,r=o!==t&&!o[0].contains(t),a&&r?n.$apply(function(){return n.popup.hidePopup()}):void 0},r.on("click",u),n.popup={state:{isOpen:!1},togglePopup:function(){return n.isDataReady?n.popup.state.isOpen=!n.popup.state.isOpen:void 0},hidePopup:function(){return n.popup.state.isOpen=!1}}}}}]),angular.module("bdate.data",[]).factory("bDataFactory",["MESSAGES",function(e){var t;return t={data:{},isDataReady:function(a){return a?!!t.data[a]&&t.isDataValid(t.data[a]):console.error(e.invalidParams)},isDataValid:function(e){return!e||angular.equals({},e)?!1:e.format&&e.delimiter&&e.today&&e.years&&Object.keys(e.years)[0]&&Object.keys(Object.keys(e.years)[0])[0]?!0:!1},setData:function(a,r){return t.isDataValid(a)?(t.data[r]=JSON.parse(JSON.stringify(a)),t.data[r].today.date=1e3*t.data[r].today.date,t.data[r]):(console.error(e.sourceDataNotValid),!1)}}}]),angular.module("bdate",["bdate.datepicker"]).constant("MESSAGES",{invalidParams:"Invalid params",errorOnChangeMonthOrYear:"cannot change month or year",sourceDataNotValid:"source data(json)is not valid",dateNotReady:"source data(json)is not ready(null?)"}),angular.module("bdate.popup",["bdate.utils","bdate.data","bdate.templates"]).directive("bdatePopup",["bDateUtils","bDataFactory","MESSAGES",function(e,t,a){return{restrict:"E",replace:!0,templateUrl:"popup.html",scope:{popupState:"=",dateModel:"=",dateStoreId:"@?"},link:function(r){return r.popup={hidePopup:function(){return r.popupState.isOpen=!1},selectDate:function(e){return r.data.setDateModel(e),r.popup.hidePopup()}},r.data={setDateModel:function(e){return e?r.dateModel=e:console.error(a.invalidParams)},format:null,setFormat:function(e){return e?r.data.format=e:console.error(a.invalidParams)},viewedDate:null,setViewedDate:function(o,n,s){return o&&n?(o=+o,n=+n,r.data.viewedDate={year:{first:+Object.keys(t.data[r.dateStoreId].years)[0],last:+Object.keys(t.data[r.dateStoreId].years)[Object.keys(t.data[r.dateStoreId].years).length-1],number:+o,count:+Object.keys(t.data[r.dateStoreId].years).length},month:{first:+Object.keys(t.data[r.dateStoreId].years[o])[0],last:+Object.keys(t.data[r.dateStoreId].years[o])[Object.keys(t.data[r.dateStoreId].years[o]).length-1],daysTotal:+t.data[r.dateStoreId].years[o][n].days_total,startDay:+t.data[r.dateStoreId].years[o][n].start_day,number:+n,name:e.getMonthName(n),count:+Object.keys(t.data[r.dateStoreId].years[o]).length},day:{number:+s}},r.data.viewedDate.days=r.data.getDaysArr(r.data.viewedDate.year,r.data.viewedDate.month)):console.error(a.invalidParams)},daysOfWeek:{get:function(){return e.daysOfWeek},getShorts:function(){return e.getDaysOfWeekShorts()}},today:null,setToday:function(e){return e?r.data.today=e:console.error(a.invalidParams)},_getPrevMonthTailDaysArr:function(t,a,o){var n,s,d,i,u;for(u=[],d={day:null,month:null,year:null},s=e.sourceCheckers.month.isPrevMonthExist(t,a,r.dateStoreId),i=0,s&&(d=e.sourceCheckers.month.getPrevMonthObj(t,a,r.dateStoreId),i=new Date(d.year,d.month,0).getDate()),n=0;o-1>n;)u.unshift({day:s?i-n:"",month:s?d.month:null,year:s?d.year:null,isOtherMonth:!0,isLocked:!s}),n++;return u},_getNextMonthTailDaysArr:function(t,a,o,n,s){var d,i,u,c,l,h;if(h=[],d=7,i=Math.ceil(s.length/d),s.length/d===Math.floor(s.length/d))return h;for(l={day:null,month:null,year:null},c=e.sourceCheckers.month.isNextMonthExist(t,a,r.dateStoreId),c&&(l=e.sourceCheckers.month.getNextMonthObj(t,a,r.dateStoreId)),u=s.length;i*d>u;)s.push({day:c?u-(n+o-2):"",month:c?l.month:null,year:c?l.year:null,isOtherMonth:!0,isLocked:!c}),u++;return h},_getMonthDaysArr:function(e,t,a){var r,o;for(o=[],r=1;a>=r;)o.push({day:r,month:t,year:e}),r++;return o},_markToday:function(e){var t;for(t=1;t<e.length;)e[t].day===r.data.today.day&&(e[t].isToday=!0),t++;return e},getDaysArr:function(e,t){var a,o,n,s,d,i;return o=+t.daysTotal,i=+t.startDay,s=r.data._getPrevMonthTailDaysArr(e.number,t.number,i),a=r.data._getMonthDaysArr(e.number,t.number,o),e.number===r.data.today.year&&t.number===r.data.today.month&&(a=r.data._markToday(a)),d=s.concat(a),n=r.data._getNextMonthTailDaysArr(e.number,t.number,i,o,d),d=d.concat(n)},goNextMonth:function(t){var a;return a=e.sourceCheckers.month.getNextAvailableMonth(t,r.data.viewedDate.year.number,r.data.viewedDate.month.number,r.dateStoreId),a?r.data.setViewedDate(a.year,a.month):void 0},goNextYear:function(t){var a;return a=e.sourceCheckers.year.getNextAvailableYear(t,r.data.viewedDate.year.number,r.data.viewedDate.month.number,r.dateStoreId),a?r.data.setViewedDate(a.year,a.month):void 0},init:function(t){var a;return r.data.setFormat(t.format),r.data.setToday(t.today),r.dateModel&&!angular.equals({},r.dateModel)?r.data.setViewedDate(r.dateModel.year,r.dateModel.month,r.dateModel.day):e.sourceCheckers.month.isMonthExist(t.today.year,t.today.month,r.dateStoreId)?r.data.setViewedDate(t.today.year,t.today.month):(a=e.sourceCheckers.year.getFirstYear(r.dateStoreId),r.data.setViewedDate(a,e.sourceCheckers.month.getFirstMonth(a,r.dateStoreId)))}},function(){return t.isDataReady(r.dateStoreId)&&r.data.init(t.data[r.dateStoreId]),r.bDateUtils=e}(),r.$watch(function(){return t.data[r.dateStoreId]},function(){return t.isDataReady(r.dateStoreId)?r.data.init(t.data[r.dateStoreId]):void 0},!0),r.$watch("popupState.isOpen",function(){return r.popupState.isOpen&&r.dateModel&&!angular.equals({},r.dateModel)?(r.data.setDateModel(r.dateModel),r.data.setViewedDate(r.dateModel.year,r.dateModel.month,r.dateModel.day)):void 0})}}}]),angular.module("bdate.utils",["bdate.data"]).factory("bDateUtils",["MESSAGES","bDataFactory","i18ng",function(e,t,a){var r,o,n,s;return n=function(e){return a.t(e)},r=[{name:n("Monday"),"short":n("Mon")},{name:n("Tuesday"),"short":n("Tue")},{name:n("Wednesday"),"short":n("Wed")},{name:n("Thursday"),"short":n("Th")},{name:n("Friday"),"short":n("Fri")},{name:n("Saturday"),"short":n("Sat")},{name:n("Sunday"),"short":n("Sun")}],s={1:{name:n("January"),"short":n("Jan")},2:{name:n("February"),"short":n("Feb")},3:{name:n("March"),"short":n("Mar")},4:{name:n("April"),"short":n("Apr")},5:{name:n("May"),"short":n("May")},6:{name:n("June"),"short":n("Jun")},7:{name:n("July"),"short":n("July")},8:{name:n("August"),"short":n("Aug")},9:{name:n("September"),"short":n("Sep")},10:{name:n("October"),"short":n("Oct")},11:{name:n("November"),"short":n("Nov")},12:{name:n("December"),"short":n("Dec")}},o={daysOfWeek:r,month:s,getDaysOfWeekShorts:function(){var e,t;for(e=0,t=[];e<r.length;)t.push(n(r[e]["short"])),e++;return t},getMonthName:function(e){return n(o.month[e].name)},makeDateModel:function(e){var t,a,r,o;return t=new Date(e),a=t.getDate(),r=t.getMonth()+1,o=t.getFullYear(),{day:a,month:r,year:o}},stringToDate:function(e,t,a){var r,o,n,s,d,i,u,c,l;return d=t.toLowerCase(),s=d.split(a),r=e.split(a),u=s.indexOf("mm"),n=s.indexOf("dd"),l=s.indexOf("yyyy"),c=+r[l],i=+r[u]-1,o=+r[n],i>12?!1:o>31?!1:new Date(c,i,o)},isValidDate:function(e){return angular.isDate||(e=new Date(e)),isNaN(e.getTime())?!1:void 0},sourceCheckers:{month:{isMonthExist:function(a,r,o){return a&&r?(a=+a,r=+r,t.isDataReady(o)&&t.data[o].years[a]?!!t.data[o].years[a][r]:!1):console.error(e.invalidParams)},isPrevMonthExist:function(e,t,a){var r,n,s,d,i;return e&&t?(e=+e,t=+t,o.sourceCheckers.month.isMonthExist(e,t,a)?(r=o.sourceCheckers.month.isFirstMonth(e,t,a),r?(n=o.sourceCheckers.year.isFirstYear(e,a),n?!1:(i=e-1,s=o.sourceCheckers.month.getLastMonth(i,a),o.sourceCheckers.month.isMonthExist(i,s,a))):(d=t-1,o.sourceCheckers.month.isMonthExist(e,d,a))):!1):!1},getPrevMonthObj:function(t,a,r){var n,s,d,i,u;return t&&a?(t=+t,a=+a,n=o.sourceCheckers.month.isFirstMonth(t,a,r),n?(s=o.sourceCheckers.year.isFirstYear(t,r),s?null:(u=t-1,d=o.sourceCheckers.month.getLastMonth(u,r),o.sourceCheckers.month.isMonthExist(u,d,r)?{year:u,month:d}:null)):(i=a-1,o.sourceCheckers.month.isMonthExist(t,i,r)?{year:t,month:i}:null)):console.error(e.invalidParams)},isNextMonthExist:function(e,t,a){var r,n,s,d,i;return e&&t?(e=+e,t=+t,o.sourceCheckers.month.isMonthExist(e,t,a)?(n=o.sourceCheckers.month.isLastMonth(e,t,a),n?(s=o.sourceCheckers.year.isLastYear(e,a),s?!1:(i=e+1,r=o.sourceCheckers.month.getFirstMonth(i,a),o.sourceCheckers.month.isMonthExist(i,r,a))):(d=t+1,o.sourceCheckers.month.isMonthExist(e,d,a))):!1):!1},getNextMonthObj:function(t,a,r){var n,s,d,i,u;return t&&a?(t=+t,a=+a,s=o.sourceCheckers.month.isLastMonth(t,a,r),s?(d=o.sourceCheckers.year.isLastYear(t,r),d?null:(u=t+1,n=o.sourceCheckers.month.getFirstMonth(u,r),o.sourceCheckers.month.isMonthExist(u,n,r)?{year:u,month:n}:null)):(i=a+1,o.sourceCheckers.month.isMonthExist(t,i,r)?{year:t,month:i}:null)):console.error(e.invalidParams)},getMonth:function(a,r,o){return a&&r?t.isDataReady(o)?t.data[o].years[a][r]:console.error(e.dateNotReady):console.error(e.invalidParams)},isFirstMonth:function(a,r,o){return t.isDataReady(o)?(a=+a,r=+r,r===+Object.keys(t.data[o].years[a])[0]):console.error(e.dateNotReady)},getFirstMonth:function(a,r){return t.isDataReady(r)?(a=+a,+Object.keys(t.data[r].years[a])[0]):console.error(e.dateNotReady)},isLastMonth:function(a,r,o){return t.isDataReady(o)?(a=+a,r=+r,r===+Object.keys(t.data[o].years[a])[Object.keys(t.data[o].years[a]).length-1]):console.error(e.dateNotReady)},getLastMonth:function(a,r){return t.isDataReady(r)?(a=+a,+Object.keys(t.data[r].years[a])[Object.keys(t.data[r].years[a]).length-1]):console.error(e.dateNotReady)},getNextAvailableMonth:function(t,a,r,n){var s,d,i,u,c;if(a=+a,r=+r,s=o.sourceCheckers.month.isFirstMonth(a,r,n),d=o.sourceCheckers.month.isLastMonth(a,r,n),u=a,i=r,t)if(d){if(u=a+1,!o.sourceCheckers.year.isYearExist(u,n))return console.error(e.errorOnChangeMonthOrYear),!1;i=o.sourceCheckers.month.getFirstMonth(u,n)}else i=r+1;else if(!t)if(s){if(u=a-1,!o.sourceCheckers.year.isYearExist(u,n))return console.error(e.errorOnChangeMonthOrYear),!1;i=o.sourceCheckers.month.getLastMonth(u,n)}else i=r-1;return c={year:u,month:i}}},year:{isYearExist:function(a,r){return a?t.isDataReady(r)?(a=+a,!!t.data[r].years[a]):!1:console.error(e.invalidParams)},getYear:function(a,r){return a?t.isDataReady(r)?t.data[r].years[a]:console.error(e.dateNotReady):console.error(e.invalidParams)},isFirstYear:function(e,a){return e=+e,e===+Object.keys(t.data[a].years)[0]},getFirstYear:function(a){return t.isDataReady(a)?+Object.keys(t.data[a].years)[0]:console.error(e.dateNotReady)},isLastYear:function(a,r){return t.isDataReady(r)?(a=+a,a===+Object.keys(t.data[r].years)[Object.keys(t.data[r].years).length-1]):console.error(e.dateNotReady)},getLastYear:function(a){return t.isDataReady(a)?+Object.keys(t.data[a].years)[Object.keys(t.data[a].years).length-1]:console.error(e.dateNotReady)},getNextAvailableYear:function(e,t,a,r){var n,s,d,i,u;if(t=+t,a=+a,n=o.sourceCheckers.year.isFirstYear(t,r),s=o.sourceCheckers.year.isLastYear(t,r),i=t,d=a,e){if(s)return!1;i=t+1,d=o.sourceCheckers.month.isMonthExist(i,a,r)?a:o.sourceCheckers.month.getFirstMonth(i,r)}else if(!e){if(n)return!1;i=t-1,d=o.sourceCheckers.month.isMonthExist(i,a,r)?a:o.sourceCheckers.month.getFirstMonth(i,r)}return u={year:i,month:d}}}}}}]);
//# sourceMappingURL=bdate.min.js.map