angular.module("bdate.datepicker",["bdate.popup","bdate.data","bdate.templates"]).directive("bdatepicker",["$filter","bDataFactory","$document",function(e,t,a){return{restrict:"E",replace:!0,templateUrl:"bdate.html",scope:{bModel:"=",bSource:"=",bRootId:"@?",bInputId:"@?",bPopupId:"@?"},controller:["$scope",function(e){return e.$watch("bSource",function(){return e.bSource&&!angular.equals({},e.bSource)?t.setData(e.bSource):void 0},!0)}],link:function(r,n){var o;return r.date={viewed:"",model:{}},r.$watch("date.model",function(){var a,n;if(!angular.equals({},r.date.model))return a=new Date(r.date.model.year,r.date.model.month-1,r.date.model.day).getTime(),n=e("date")(a,t.data.format),r.date.viewed=n,r.bModel=r.date.viewed}),o=function(e){var t,a,o,s;return a=r.popup.state.isOpen,t=e.target,s=n,o=s!==t&&!s[0].contains(t),a&&o?r.$apply(function(){return r.popup.hidePopup()}):void 0},a.on("click",o),r.popup={state:{isOpen:!1},togglePopup:function(){return r.popup.state.isOpen=!r.popup.state.isOpen},hidePopup:function(){return r.popup.state.isOpen=!1}}}}}]),angular.module("bdate.data",[]).factory("bDataFactory",["MESSAGES",function(e){var t;return t={data:null,isDataReady:function(){return!!t.data&&t.isDataValid(t.data)},isDataValid:function(e){return e.format&&e.today&&e.years&&Object.keys(e.years)[0]&&Object.keys(Object.keys(e.years)[0])[0]?!0:!1},setData:function(a){return t.isDataValid(a)?t.data=a:(console.error(e.sourceDataNotValid),!1)}}}]),angular.module("bdate",["bdate.datepicker"]).constant("MESSAGES",{invalidParams:"Invalid params",errorOnChangeMonthOrYear:"cannot change month or year",sourceDataNotValid:"source data(json)is not valid"}),angular.module("bdate.popup",["bdate.utils","bdate.data","bdate.templates"]).directive("bdatePopup",["bDateUtils","bDataFactory","MESSAGES",function(e,t,a){return{restrict:"E",replace:!0,templateUrl:"popup.html",scope:{popupState:"=",dateModel:"="},link:function(r){return r.popup={hidePopup:function(){return r.popupState.isOpen=!1},selectDate:function(e){return r.data.setDateModel(e),r.popup.hidePopup()}},r.data={setDateModel:function(e){return e?r.dateModel=e:console.error(a.invalidParams)},format:null,setFormat:function(e){return e?r.data.format=e:console.error(a.invalidParams)},viewedDate:null,setViewedDate:function(n,o,s){return n&&o?(n=+n,o=+o,r.data.viewedDate={year:{first:Object.keys(t.data.years)[0],last:Object.keys(t.data.years)[Object.keys(t.data.years).length-1],number:n,count:Object.keys(t.data.years).length},month:{first:Object.keys(t.data.years[n])[0],last:Object.keys(t.data.years[n])[Object.keys(t.data.years[n]).length-1],daysTotal:t.data.years[n][o].days_total,startDay:t.data.years[n][o].start_day,number:o,name:e.getMonthName(o),count:Object.keys(t.data.years[n]).length},day:{number:s}},r.data.viewedDate.days=r.data.getDaysArr(r.data.viewedDate.year,r.data.viewedDate.month)):console.error(a.invalidParams)},daysOfWeek:{get:function(){return e.daysOfWeek},getShorts:function(){return e.getDaysOfWeekShorts()}},today:null,setToday:function(e){return e?r.data.today=e:console.error(a.invalidParams)},_getPrevMonthTailDaysArr:function(t,a,r){var n,o,s,d,i;for(i=[],s={day:null,month:null,year:null},o=e.sourceCheckers.month.isPrevMonthExist(t,a),d=0,o&&(s=e.sourceCheckers.month.getPrevMonthObj(t,a),d=new Date(s.year,s.month,0).getDate()),n=0;r-1>n;)i.unshift({day:d-n,month:s.month,year:s.year,isOtherMonth:!0}),n++;return i},_getNextMonthTailDaysArr:function(t,a,r,n,o){var s,d,i,u,c,h;if(h=[],s=7,d=Math.ceil(o.length/s),o.length/s===Math.floor(o.length/s))return h;for(c={day:null,month:null,year:null},u=e.sourceCheckers.month.isNextMonthExist(t,a),u&&(c=e.sourceCheckers.month.getNextMonthObj(t,a)),i=o.length;d*s>i;)o.push({day:i-(n+r-2),month:c.month,year:c.year,isOtherMonth:!0}),i++;return h},_getMonthDaysArr:function(e,t,a){var r,n;for(n=[],r=1;a>=r;)n.push({day:r,month:t,year:e}),r++;return n},_markToday:function(e){var t;for(t=1;t<e.length;)e[t].day===r.data.today.day&&(e[t].isToday=!0),t++;return e},getDaysArr:function(e,t){var a,n,o,s,d,i;return n=+t.daysTotal,i=+t.startDay,s=r.data._getPrevMonthTailDaysArr(e.number,t.number,i),a=r.data._getMonthDaysArr(e.number,t.number,n),e.number===r.data.today.year&&t.number===r.data.today.month&&(a=r.data._markToday(a)),d=s.concat(a),o=r.data._getNextMonthTailDaysArr(e.number,t.number,i,n,d),d=d.concat(o)},goNextMonth:function(t){var a;return a=e.sourceCheckers.month.getNextAvailableMonth(t,r.data.viewedDate.year.number,r.data.viewedDate.month.number),a?r.data.setViewedDate(a.year,a.month):void 0},goNextYear:function(t){var a;return a=e.sourceCheckers.year.getNextAvailableYear(t,r.data.viewedDate.year.number,r.data.viewedDate.month.number),a?r.data.setViewedDate(a.year,a.month):void 0},init:function(t){var a;return r.data.setFormat(t.format),r.data.setToday(t.today),r.dateModel&&!angular.equals({},r.dateModel)?r.data.setViewedDate(r.dateModel.year,r.dateModel.month,r.dateModel.day):e.sourceCheckers.month.isMonthExist(t.today.year,t.today.month)?r.data.setViewedDate(t.today.year,t.today.month):(a=e.sourceCheckers.year.getFirstYear(),r.data.setViewedDate(a,e.sourceCheckers.month.getFirstMonth(a)))}},function(){return t.isDataReady(t.data)&&r.data.init(t.data),r.bDateUtils=e}(),r.$watch(function(){return t.data},function(){return t.isDataReady(t.data)?r.data.init(t.data):void 0},!0),r.$watch("popupState.isOpen",function(){return r.popupState.isOpen&&r.dateModel&&!angular.equals({},r.dateModel)?(r.data.setDateModel(r.dateModel),r.data.setViewedDate(r.dateModel.year,r.dateModel.month,r.dateModel.day)):void 0})}}}]),angular.module("bdate.utils",["bdate.data"]).factory("bDateUtils",["MESSAGES","bDataFactory",function(e,t){var a,r,n;return a=[{name:"Понедельник","short":"Пн"},{name:"Вторник","short":"Вт"},{name:"Среда","short":"Ср"},{name:"Четверг","short":"Чт"},{name:"Пятница","short":"Пт"},{name:"Суббота","short":"Сб"},{name:"Воскресенье","short":"Вс"}],n={1:{name:"Январь","short":"Янв"},2:{name:"Февраль","short":"Фев"},3:{name:"Март","short":"Март"},4:{name:"Апрель","short":"Май"},5:{name:"Май","short":"Май"},6:{name:"Июнь","short":"Июнь"},7:{name:"Июль","short":"Июль"},8:{name:"Август","short":"Авг"},9:{name:"Сентябрь","short":"Сент"},10:{name:"Октябрь","short":"Окт"},11:{name:"Ноябрь","short":"Ноя"},12:{name:"Декабрь","short":"Дек"}},r={daysOfWeek:a,month:n,getDaysOfWeekShorts:function(){var e,t;for(e=0,t=[];e<a.length;)t.push(a[e]["short"]),e++;return t},getMonthName:function(e){return n[e].name},makeDateModel:function(e){var t,a,r;return t=new Date(e),a=t.getUTCDate(),n=t.getMonth()+1,r=t.getFullYear(),{day:a,month:n,year:r}},sourceCheckers:{month:{isMonthExist:function(a,r){return a&&r?(a=+a,r=+r,t.data.years[a]?!!t.data.years[a][r]:!1):console.error(e.invalidParams)},isPrevMonthExist:function(t,a){var n,o,s,d,i;return t&&a?(t=+t,a=+a,r.sourceCheckers.month.isMonthExist(t,a)?(n=r.sourceCheckers.month.isFirstMonth(t,a),n?(o=r.sourceCheckers.year.isFirstYear(t),o?!1:(i=t-1,s=r.sourceCheckers.month.getLastMonth(i),r.sourceCheckers.month.isMonthExist(i,s))):(d=a-1,r.sourceCheckers.month.isMonthExist(t,d))):!1):console.error(e.invalidParams)},getPrevMonthObj:function(t,a){var n,o,s,d,i;return t&&a?(t=+t,a=+a,n=r.sourceCheckers.month.isFirstMonth(t,a),n?(o=r.sourceCheckers.year.isFirstYear(t),o?null:(i=t-1,s=r.sourceCheckers.month.getLastMonth(i),r.sourceCheckers.month.isMonthExist(i,s)?{year:i,month:s}:null)):(d=a-1,r.sourceCheckers.month.isMonthExist(t,d)?{year:t,month:d}:null)):console.error(e.invalidParams)},isNextMonthExist:function(t,a){var n,o,s,d,i;return t&&a?(t=+t,a=+a,r.sourceCheckers.month.isMonthExist(t,a)?(o=r.sourceCheckers.month.isLastMonth(t,a),o?(s=r.sourceCheckers.year.isLastYear(t),s?!1:(i=t+1,n=r.sourceCheckers.month.getFirstMonth(i),r.sourceCheckers.month.isMonthExist(i,n))):(d=a+1,r.sourceCheckers.month.isMonthExist(t,d))):!1):console.error(e.invalidParams)},getNextMonthObj:function(t,a){var n,o,s,d,i;return t&&a?(t=+t,a=+a,o=r.sourceCheckers.month.isLastMonth(t,a),o?(s=r.sourceCheckers.year.isLastYear(t),s?null:(i=t+1,n=r.sourceCheckers.month.getFirstMonth(i),r.sourceCheckers.month.isMonthExist(i,n)?{year:i,month:n}:null)):(d=a+1,r.sourceCheckers.month.isMonthExist(t,d)?{year:t,month:d}:null)):console.error(e.invalidParams)},getMonth:function(a,r){return a&&r?t.data.years[a][r]:console.error(e.invalidParams)},isFirstMonth:function(e,a){return e=+e,a=+a,a===+Object.keys(t.data.years[e])[0]},getFirstMonth:function(e){return e=+e,+Object.keys(t.data.years[e])[0]},isLastMonth:function(e,a){return e=+e,a=+a,a===+Object.keys(t.data.years[e])[Object.keys(t.data.years[e]).length-1]},getLastMonth:function(e){return e=+e,+Object.keys(t.data.years[e])[Object.keys(t.data.years[e]).length-1]},getNextAvailableMonth:function(t,a,n){var o,s,d,i,u;if(a=+a,n=+n,o=r.sourceCheckers.month.isFirstMonth(a,n),s=r.sourceCheckers.month.isLastMonth(a,n),i=a,d=n,t)if(s){if(i=a+1,!r.sourceCheckers.year.isYearExist(i))return console.error(e.errorOnChangeMonthOrYear),!1;d=r.sourceCheckers.month.getFirstMonth(i)}else d=n+1;else if(!t)if(o){if(i=a-1,!r.sourceCheckers.year.isYearExist(i))return console.error(e.errorOnChangeMonthOrYear),!1;d=r.sourceCheckers.month.getLastMonth(i)}else d=n-1;return u={year:i,month:d}}},year:{isYearExist:function(a){return a?(a=+a,!!t.data.years[a]):console.error(e.invalidParams)},getYear:function(a){return a?t.data.years[a]:console.error(e.invalidParams)},isFirstYear:function(e){return e=+e,e===+Object.keys(t.data.years)[0]},getFirstYear:function(){return+Object.keys(t.data.years)[0]},isLastYear:function(e){return e=+e,e===+Object.keys(t.data.years)[Object.keys(t.data.years).length-1]},getLastYear:function(){return+Object.keys(t.data.years)[Object.keys(t.data.years).length-1]},getNextAvailableYear:function(e,t,a){var n,o,s,d,i;if(t=+t,a=+a,n=r.sourceCheckers.year.isFirstYear(t),o=r.sourceCheckers.year.isLastYear(t),d=t,s=a,e){if(o)return!1;d=t+1,s=r.sourceCheckers.month.isMonthExist(d,a)?a:r.sourceCheckers.month.getFirstMonth(d)}else if(!e){if(n)return!1;d=t-1,s=r.sourceCheckers.month.isMonthExist(d,a)?a:r.sourceCheckers.month.getFirstMonth(d)}return i={year:d,month:s}}}}}}]),angular.module("bdate.templates",[]).run(["$templateCache",function(e){e.put("bdate.html",'<div id={{bRootId}} class=b_datepicker_root><input type=text id={{bInputId}} ng-model=date.viewed ng-click=popup.togglePopup() ng-class="{b_datepicker_in_progress: !isDataReady}" readonly=readonly class=b_input><button type=button ng-click=popup.togglePopup() class=b_datepicker_button>H</button><bdate-popup id={{bPopupId}} popup-state=popup.state date-model=date.model></bdate-popup></div>'),e.put("popup.html",'<div ng-show=popupState.isOpen class=b_popup><div class=b_popup_controls><div class=b_btn_prev_container><button type=button ng-click=data.goNextYear(false) ng-disabled="!bDateUtils.sourceCheckers.year.isYearExist(data.viewedDate.year.number - 1)" class="b_popup_btn b_btn_prev"><<</button><button type=button ng-click=data.goNextMonth(false) ng-disabled="!bDateUtils.sourceCheckers.month.isPrevMonthExist(data.viewedDate.year.number, data.viewedDate.month.number)" class="b_popup_btn b_btn_prev"><</button></div><div ng-bind=data.viewedDate.month.name class=b_popup_month></div>&nbsp;<div ng-bind=data.viewedDate.year.number class=b_popup_year></div><div class=b_btn_next_container><button type=button ng-click=data.goNextMonth(true) ng-disabled="!bDateUtils.sourceCheckers.month.isNextMonthExist(data.viewedDate.year.number, data.viewedDate.month.number)" class="b_popup_btn b_btn_next">></button><button type=button ng-click=data.goNextYear(true) ng-disabled="!bDateUtils.sourceCheckers.year.isYearExist(data.viewedDate.year.number + 1)" class="b_popup_btn b_btn_next">>></button></div></div><table class=b_popup_days><tr><td ng-repeat="dayOfWeek in ::data.daysOfWeek.getShorts()" class=b_popup_day_of_week><span ng-bind=::dayOfWeek></span></td></tr></table><table class=b_popup_weeks><tr class=b_popup_week><td ng-repeat="date in data.viewedDate.days track by $index" class=b_popup_day><button type=button ng-bind=date.day ng-click=popup.selectDate(date) ng-class="{b_popup_cur_month_day: !date.isOtherMonth, b_popup_today_day: date.isToday, b_popup_selected_day: date.day == dateModel.day &amp;&amp; date.month == dateModel.month &amp;&amp; date.year == dateModel.year}" class=b_popup_day_btn></button></td></tr></table><div class=b_popup_today>Сегодня<button type=button ng-bind="data.today.date | date:data.format" ng-click=popup.selectDate(bDateUtils.makeDateModel(data.today.date)) class=b_popup_today_btn></button></div></div>')}]);
//# sourceMappingURL=bdate.min.js.map