angular.module("bdate.datepicker",["bdate.popup","bdate.data","bdate.templates"]).directive("bdatepicker",["$filter","bDataFactory","bDateUtils","$document",function(e,t,a,r){return{restrict:"E",replace:!0,templateUrl:"bdate.html",scope:{bModel:"=",bSource:"=",bRootId:"@?",bInputId:"@?",bPopupId:"@?",bRootClasses:"@?",bInputClasses:"@?",bButtonClasses:"@?",bPopupClasses:"@?"},controller:["$scope",function(e){return e.isDataReady=!1,e.$watch("bSource",function(){return t.isDataValid(e.bSource)?(t.setData(e.bSource),e.isDataReady=!0):void 0},!0)}],link:function(o,n){var s,d;return o.date={viewed:"",model:{}},s=!1,o.$watch("bModel",function(e,r){var n,d,i;return i=o.bModel===o.date.viewed,d=""===o.bModel||" "===o.bModel||!o.bModel,i||d?!1:(n=a.stringToDate(o.bModel,t.data.format,t.data.delimiter),angular.isDate(n)?(o.date.viewed=o.bModel,s=!0,o.date.model={day:n.getDate(),month:n.getMonth()+1,year:n.getFullYear()}):!1)}),o.$watch("date.model",function(){var a,r;if(!angular.equals({},o.date.model))return s?s=!1:(a=new Date(o.date.model.year,o.date.model.month-1,o.date.model.day).getTime(),r=e("date")(a,t.data.format),o.date.viewed=r,o.bModel=o.date.viewed)}),d=function(e){var t,a,r,s;return a=o.popup.state.isOpen,t=e.target,s=n,r=s!==t&&!s[0].contains(t),a&&r?o.$apply(function(){return o.popup.hidePopup()}):void 0},r.on("click",d),o.popup={state:{isOpen:!1},togglePopup:function(){return o.isDataReady?o.popup.state.isOpen=!o.popup.state.isOpen:void 0},hidePopup:function(){return o.popup.state.isOpen=!1}}}}}]),angular.module("bdate.data",[]).factory("bDataFactory",["MESSAGES",function(e){var t;return t={data:null,isDataReady:function(){return!!t.data&&t.isDataValid(t.data)},isDataValid:function(e){return!e||angular.equals({},e)?!1:e.format&&e.delimiter&&e.today&&e.years&&Object.keys(e.years)[0]&&Object.keys(Object.keys(e.years)[0])[0]?!0:!1},setData:function(a){return t.isDataValid(a)?(t.data=JSON.parse(JSON.stringify(a)),t.data.today.date=1e3*t.data.today.date,t.data):(console.error(e.sourceDataNotValid),!1)}}}]),angular.module("bdate",["bdate.datepicker"]).constant("MESSAGES",{invalidParams:"Invalid params",errorOnChangeMonthOrYear:"cannot change month or year",sourceDataNotValid:"source data(json)is not valid",dateNotReady:"source data(json)is not ready(null?)"}),angular.module("bdate.popup",["bdate.utils","bdate.data","bdate.templates"]).directive("bdatePopup",["bDateUtils","bDataFactory","MESSAGES",function(e,t,a){return{restrict:"E",replace:!0,templateUrl:"popup.html",scope:{popupState:"=",dateModel:"="},link:function(r){return r.popup={hidePopup:function(){return r.popupState.isOpen=!1},selectDate:function(e){return r.data.setDateModel(e),r.popup.hidePopup()}},r.data={setDateModel:function(e){return e?r.dateModel=e:console.error(a.invalidParams)},format:null,setFormat:function(e){return e?r.data.format=e:console.error(a.invalidParams)},viewedDate:null,setViewedDate:function(o,n,s){return o&&n?(o=+o,n=+n,r.data.viewedDate={year:{first:+Object.keys(t.data.years)[0],last:+Object.keys(t.data.years)[Object.keys(t.data.years).length-1],number:+o,count:+Object.keys(t.data.years).length},month:{first:+Object.keys(t.data.years[o])[0],last:+Object.keys(t.data.years[o])[Object.keys(t.data.years[o]).length-1],daysTotal:+t.data.years[o][n].days_total,startDay:+t.data.years[o][n].start_day,number:+n,name:e.getMonthName(n),count:+Object.keys(t.data.years[o]).length},day:{number:+s}},r.data.viewedDate.days=r.data.getDaysArr(r.data.viewedDate.year,r.data.viewedDate.month)):console.error(a.invalidParams)},daysOfWeek:{get:function(){return e.daysOfWeek},getShorts:function(){return e.getDaysOfWeekShorts()}},today:null,setToday:function(e){return e?r.data.today=e:console.error(a.invalidParams)},_getPrevMonthTailDaysArr:function(t,a,r){var o,n,s,d,i;for(i=[],s={day:null,month:null,year:null},n=e.sourceCheckers.month.isPrevMonthExist(t,a),d=0,n&&(s=e.sourceCheckers.month.getPrevMonthObj(t,a),d=new Date(s.year,s.month,0).getDate()),o=0;r-1>o;)i.unshift({day:n?d-o:"",month:n?s.month:null,year:n?s.year:null,isOtherMonth:!0,isLocked:!n}),o++;return i},_getNextMonthTailDaysArr:function(t,a,r,o,n){var s,d,i,u,c,l;if(l=[],s=7,d=Math.ceil(n.length/s),n.length/s===Math.floor(n.length/s))return l;for(c={day:null,month:null,year:null},u=e.sourceCheckers.month.isNextMonthExist(t,a),u&&(c=e.sourceCheckers.month.getNextMonthObj(t,a)),i=n.length;d*s>i;)n.push({day:i-(o+r-2),month:c.month,year:c.year,isOtherMonth:!0}),i++;return l},_getMonthDaysArr:function(e,t,a){var r,o;for(o=[],r=1;a>=r;)o.push({day:r,month:t,year:e}),r++;return o},_markToday:function(e){var t;for(t=1;t<e.length;)e[t].day===r.data.today.day&&(e[t].isToday=!0),t++;return e},getDaysArr:function(e,t){var a,o,n,s,d,i;return o=+t.daysTotal,i=+t.startDay,s=r.data._getPrevMonthTailDaysArr(e.number,t.number,i),a=r.data._getMonthDaysArr(e.number,t.number,o),e.number===r.data.today.year&&t.number===r.data.today.month&&(a=r.data._markToday(a)),d=s.concat(a),n=r.data._getNextMonthTailDaysArr(e.number,t.number,i,o,d),d=d.concat(n)},goNextMonth:function(t){var a;return a=e.sourceCheckers.month.getNextAvailableMonth(t,r.data.viewedDate.year.number,r.data.viewedDate.month.number),a?r.data.setViewedDate(a.year,a.month):void 0},goNextYear:function(t){var a;return a=e.sourceCheckers.year.getNextAvailableYear(t,r.data.viewedDate.year.number,r.data.viewedDate.month.number),a?r.data.setViewedDate(a.year,a.month):void 0},init:function(t){var a;return r.data.setFormat(t.format),r.data.setToday(t.today),r.dateModel&&!angular.equals({},r.dateModel)?r.data.setViewedDate(r.dateModel.year,r.dateModel.month,r.dateModel.day):e.sourceCheckers.month.isMonthExist(t.today.year,t.today.month)?r.data.setViewedDate(t.today.year,t.today.month):(a=e.sourceCheckers.year.getFirstYear(),r.data.setViewedDate(a,e.sourceCheckers.month.getFirstMonth(a)))}},function(){return t.isDataReady(t.data)&&r.data.init(t.data),r.bDateUtils=e}(),r.$watch(function(){return t.data},function(){return t.isDataReady(t.data)?r.data.init(t.data):void 0},!0),r.$watch("popupState.isOpen",function(){return r.popupState.isOpen&&r.dateModel&&!angular.equals({},r.dateModel)?(r.data.setDateModel(r.dateModel),r.data.setViewedDate(r.dateModel.year,r.dateModel.month,r.dateModel.day)):void 0})}}}]),angular.module("bdate.utils",["bdate.data"]).factory("bDateUtils",["MESSAGES","bDataFactory",function(e,t){var a,r,o;return a=[{name:"Понедельник","short":"Пн"},{name:"Вторник","short":"Вт"},{name:"Среда","short":"Ср"},{name:"Четверг","short":"Чт"},{name:"Пятница","short":"Пт"},{name:"Суббота","short":"Сб"},{name:"Воскресенье","short":"Вс"}],o={1:{name:"Январь","short":"Янв"},2:{name:"Февраль","short":"Фев"},3:{name:"Март","short":"Март"},4:{name:"Апрель","short":"Май"},5:{name:"Май","short":"Май"},6:{name:"Июнь","short":"Июнь"},7:{name:"Июль","short":"Июль"},8:{name:"Август","short":"Авг"},9:{name:"Сентябрь","short":"Сент"},10:{name:"Октябрь","short":"Окт"},11:{name:"Ноябрь","short":"Ноя"},12:{name:"Декабрь","short":"Дек"}},r={daysOfWeek:a,month:o,getDaysOfWeekShorts:function(){var e,t;for(e=0,t=[];e<a.length;)t.push(a[e]["short"]),e++;return t},getMonthName:function(e){return r.month[e].name},makeDateModel:function(e){var t,a,r,o;return t=new Date(e),a=t.getDate(),r=t.getMonth()+1,o=t.getFullYear(),{day:a,month:r,year:o}},stringToDate:function(e,t,a){var r,o,n,s,d,i,u,c,l;return d=t.toLowerCase(),s=d.split(a),r=e.split(a),u=s.indexOf("mm"),n=s.indexOf("dd"),l=s.indexOf("yyyy"),c=+r[l],i=+r[u]-1,o=+r[n],i>12?!1:o>31?!1:new Date(c,i,o)},isValidDate:function(e){return angular.isDate||(e=new Date(e)),isNaN(e.getTime())?!1:void 0},sourceCheckers:{month:{isMonthExist:function(a,r){return a&&r?(a=+a,r=+r,t.isDataReady()&&t.data.years[a]?!!t.data.years[a][r]:!1):console.error(e.invalidParams)},isPrevMonthExist:function(e,t){var a,o,n,s,d;return e&&t?(e=+e,t=+t,r.sourceCheckers.month.isMonthExist(e,t)?(a=r.sourceCheckers.month.isFirstMonth(e,t),a?(o=r.sourceCheckers.year.isFirstYear(e),o?!1:(d=e-1,n=r.sourceCheckers.month.getLastMonth(d),r.sourceCheckers.month.isMonthExist(d,n))):(s=t-1,r.sourceCheckers.month.isMonthExist(e,s))):!1):!1},getPrevMonthObj:function(t,a){var o,n,s,d,i;return t&&a?(t=+t,a=+a,o=r.sourceCheckers.month.isFirstMonth(t,a),o?(n=r.sourceCheckers.year.isFirstYear(t),n?null:(i=t-1,s=r.sourceCheckers.month.getLastMonth(i),r.sourceCheckers.month.isMonthExist(i,s)?{year:i,month:s}:null)):(d=a-1,r.sourceCheckers.month.isMonthExist(t,d)?{year:t,month:d}:null)):console.error(e.invalidParams)},isNextMonthExist:function(e,t){var a,o,n,s,d;return e&&t?(e=+e,t=+t,r.sourceCheckers.month.isMonthExist(e,t)?(o=r.sourceCheckers.month.isLastMonth(e,t),o?(n=r.sourceCheckers.year.isLastYear(e),n?!1:(d=e+1,a=r.sourceCheckers.month.getFirstMonth(d),r.sourceCheckers.month.isMonthExist(d,a))):(s=t+1,r.sourceCheckers.month.isMonthExist(e,s))):!1):!1},getNextMonthObj:function(t,a){var o,n,s,d,i;return t&&a?(t=+t,a=+a,n=r.sourceCheckers.month.isLastMonth(t,a),n?(s=r.sourceCheckers.year.isLastYear(t),s?null:(i=t+1,o=r.sourceCheckers.month.getFirstMonth(i),r.sourceCheckers.month.isMonthExist(i,o)?{year:i,month:o}:null)):(d=a+1,r.sourceCheckers.month.isMonthExist(t,d)?{year:t,month:d}:null)):console.error(e.invalidParams)},getMonth:function(a,r){return a&&r?t.isDataReady()?t.data.years[a][r]:console.error(e.dateNotReady):console.error(e.invalidParams)},isFirstMonth:function(a,r){return t.isDataReady()?(a=+a,r=+r,r===+Object.keys(t.data.years[a])[0]):console.error(e.dateNotReady)},getFirstMonth:function(a){return t.isDataReady()?(a=+a,+Object.keys(t.data.years[a])[0]):console.error(e.dateNotReady)},isLastMonth:function(a,r){return t.isDataReady()?(a=+a,r=+r,r===+Object.keys(t.data.years[a])[Object.keys(t.data.years[a]).length-1]):console.error(e.dateNotReady)},getLastMonth:function(a){return t.isDataReady()?(a=+a,+Object.keys(t.data.years[a])[Object.keys(t.data.years[a]).length-1]):console.error(e.dateNotReady)},getNextAvailableMonth:function(t,a,o){var n,s,d,i,u;if(a=+a,o=+o,n=r.sourceCheckers.month.isFirstMonth(a,o),s=r.sourceCheckers.month.isLastMonth(a,o),i=a,d=o,t)if(s){if(i=a+1,!r.sourceCheckers.year.isYearExist(i))return console.error(e.errorOnChangeMonthOrYear),!1;d=r.sourceCheckers.month.getFirstMonth(i)}else d=o+1;else if(!t)if(n){if(i=a-1,!r.sourceCheckers.year.isYearExist(i))return console.error(e.errorOnChangeMonthOrYear),!1;d=r.sourceCheckers.month.getLastMonth(i)}else d=o-1;return u={year:i,month:d}}},year:{isYearExist:function(a){return a?t.isDataReady()?(a=+a,!!t.data.years[a]):!1:console.error(e.invalidParams)},getYear:function(a){return a?t.isDataReady()?t.data.years[a]:console.error(e.dateNotReady):console.error(e.invalidParams)},isFirstYear:function(e){return e=+e,e===+Object.keys(t.data.years)[0]},getFirstYear:function(){return t.isDataReady()?+Object.keys(t.data.years)[0]:console.error(e.dateNotReady)},isLastYear:function(a){return t.isDataReady()?(a=+a,a===+Object.keys(t.data.years)[Object.keys(t.data.years).length-1]):console.error(e.dateNotReady)},getLastYear:function(){return t.isDataReady()?+Object.keys(t.data.years)[Object.keys(t.data.years).length-1]:console.error(e.dateNotReady)},getNextAvailableYear:function(e,t,a){var o,n,s,d,i;if(t=+t,a=+a,o=r.sourceCheckers.year.isFirstYear(t),n=r.sourceCheckers.year.isLastYear(t),d=t,s=a,e){if(n)return!1;d=t+1,s=r.sourceCheckers.month.isMonthExist(d,a)?a:r.sourceCheckers.month.getFirstMonth(d)}else if(!e){if(o)return!1;d=t-1,s=r.sourceCheckers.month.isMonthExist(d,a)?a:r.sourceCheckers.month.getFirstMonth(d)}return i={year:d,month:s}}}}}}]),angular.module("bdate.templates",[]).run(["$templateCache",function(e){e.put("bdate.html",'<div id={{::bRootId}} ng-class="{b_datepicker_in_progress: !isDataReady}" class="b_datepicker_root {{::bRootClasses}}"><input type=text id={{::bInputId}} ng-model=date.viewed ng-click=popup.togglePopup() ng-disabled=!isDataReady readonly=readonly class="b_datepicker_input {{::bInputClasses}}"><button type=button ng-click=popup.togglePopup() ng-disabled=!isDataReady class="b_datepicker_button {{::bButtonClasses}}">&nbsp;</button><bdate-popup id={{::bPopupId}} popup-state=popup.state date-model=date.model class={{::bPopupClasses}}></bdate-popup></div>'),e.put("popup.html",'<div ng-show=popupState.isOpen class=b_popup><div class=b_popup_controls><div class=b_btn_prev_container><button type=button ng-click=data.goNextYear(false) ng-disabled="!bDateUtils.sourceCheckers.year.isYearExist(data.viewedDate.year.number - 1)" class="b_popup_btn b_btn_prev">&#9664;&#9664;</button><button type=button ng-click=data.goNextMonth(false) ng-disabled="!bDateUtils.sourceCheckers.month.isPrevMonthExist(data.viewedDate.year.number, data.viewedDate.month.number)" class="b_popup_btn b_btn_prev">&#9664;</button></div><div ng-bind=data.viewedDate.month.name class=b_popup_month></div>&nbsp;<div ng-bind=data.viewedDate.year.number class=b_popup_year></div><div class=b_btn_next_container><button type=button ng-click=data.goNextMonth(true) ng-disabled="!bDateUtils.sourceCheckers.month.isNextMonthExist(data.viewedDate.year.number, data.viewedDate.month.number)" class="b_popup_btn b_btn_next">&#9654;</button><button type=button ng-click=data.goNextYear(true) ng-disabled="!bDateUtils.sourceCheckers.year.isYearExist(data.viewedDate.year.number + 1)" class="b_popup_btn b_btn_next">&#9654;&#9654;</button></div></div><table class=b_popup_days><tr><td ng-repeat="dayOfWeek in ::data.daysOfWeek.getShorts()" class=b_popup_day_of_week><span ng-bind=::dayOfWeek></span></td></tr></table><table class=b_popup_weeks><tr class=b_popup_week><td ng-repeat="date in data.viewedDate.days track by $index" ng-class="{b_popup_today_day_container: date.isToday}" class=b_popup_day><button type=button ng-bind=date.day ng-click=popup.selectDate(date) ng-disabled=date.isLocked ng-class="{b_popup_cur_month_day: !date.isOtherMonth, b_popup_today_day: date.isToday, b_popup_selected_day: date.day == dateModel.day &amp;&amp; date.month == dateModel.month &amp;&amp; date.year == dateModel.year, b_popup_locked_day: date.isLocked}" class=b_popup_day_btn></button></td></tr></table><div ng-show="bDateUtils.isMonthExist(data.today.year, data.today.month)" class=b_popup_today>Сегодня<button type=button ng-bind="data.today.date | date:data.format" ng-click=popup.selectDate(bDateUtils.makeDateModel(data.today.date)) class=b_popup_today_btn></button></div></div>')}]);
//# sourceMappingURL=bdate.min.js.map